<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link
			rel="shortcut icon"
			type="image/png"
			href="../favicon-32x32.png"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
			crossorigin="anonymous"
		/>
		<title>Sena Chatbot Test</title>
		<!-- IP Location -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
		<script>
			$.getJSON(
				'https://json.geoiplookup.io/?callback=?',
				function (data) {
					$('#location').append(`
					<p>
						<b>City:</b> ${data.city}, <b>State:</b> ${data.region},
						<b>Zip Code:</b> ${data.postal_code},
						<b>Country:</b> ${data.country_name}
					</p>
				`);
					console.log(JSON.stringify(data, null, 2));
					// check for clear local storage
			if (!localStorage.getItem('bc-sid')) {
				console.log('Sena chat refreshed');
			}
			// check for the url pathname
			var urlPath = window.location.pathname;
			// console.log(urlPath);
			function detectLanguage(urlPathname) {
				//split url path into array of items
				var pathItems = urlPathname.split('/');
				// console.log(pathItems);
				var language = '';
				// check for fr, de, es and it cases - en is default
				switch (pathItems[2]) {
					case 'fr':
						return (language = 'fr');
					case 'de':
						return (language = 'de');
					case 'es':
						return (language = 'es');
					case 'it':
						return (language = 'it');
					default:
						return (language = 'en');
				}
			}
			// store site language into variable
			const siteLanguage = detectLanguage(urlPath);
			console.log('site language = ', siteLanguage);

			window.botmindWidget = null;
			function initBotmindChat() {
				if (window.botmindWidget.works && window.botmindWidget.init) {
					window.botmindWidget.init({
						token: 'd04f06fc-bb83-45d8-9b39-4b5443ab4bd9',
						host: 'https://api.widget.botmind.io',
						language: siteLanguage, // insert variable into chatbot initializer
					},{
						customData: [
							{
								key: 'user_country',
								value: data.country_code
							}, 
							{
								key:'user_coordinates',
								value: `${data.latitude}, ${data.longitude}`
							}
						]
					});
				}
			}
			function BCinitialize(i, t) {
				var n;
				i.getElementById(t)
					? initBotmindChat()
					: (((n = i.createElement('script')).id = t),
					  (n.async = !0),
					  (n.src =
							'https://widget.botmind.io' + '/public/widget.js'),
					  (n.onload = initBotmindChat),
					  i.head.appendChild(n));
			}
			function BCinitiateCall() {
				BCinitialize(document, 'botmind-webchat-js');
			}
			if (document.readyState === 'loading') {
				window.addEventListener
					? window.addEventListener('load', BCinitiateCall, !1)
					: window.attachEvent('load', BCinitiateCall, !1);
			} else {
				BCinitiateCall();
			}
				}
			);
		</script>
		<script>
			function refreshLocalStorage() {
				localStorage.removeItem('bc-sid');
			}
		</script>
	</head>
	<style>
		.navbar {
			background-color: #b32d26 !important;
		}
		.navbar > a {
			color: white !important;
		}
		.buttons-container,
		.buttons {
			display: flex;
			flex-direction: row;
			justify-content: center;
		}
		.buttons-container {
			justify-content: space-around;
			flex-wrap: wrap;
		}
		.btn-md {
			min-width: 6rem !important;
		}
	</style>
	<body>
		<nav
			class="
				navbar navbar-light
				bg-light
				d-flex
				justify-content-center
				mb-5
			"
		>
			<a class="navbar-brand" href="#"><b>Sena Chatbot Test</b> </a>
		</nav>
		<div class="container">
			<div class="row justify-content-md-center mb-4">
				<div class="col-md-auto text-center">
					<h1>Spanish</h1>
				</div>
			</div>
			<div class="buttons">
				<div class="buttons-container">
					<a
						href="https://pablomotta.github.io/sena-chatbot"
						class="btn btn-warning btn-md m-2"
						onclick="refreshLocalStorage();"
						>English</a
					>
					<a
						href="https://pablomotta.github.io/sena-chatbot/fr"
						class="btn btn-warning btn-md m-2"
						onclick="refreshLocalStorage();"
						>French</a
					>
					<a
						href="https://pablomotta.github.io/sena-chatbot/de"
						class="btn btn-warning btn-md m-2"
						onclick="refreshLocalStorage();"
						>German</a
					>
					<a
						href="https://pablomotta.github.io/sena-chatbot/it"
						class="btn btn-warning btn-md m-2"
						onclick="refreshLocalStorage();"
						>Italian</a
					>
					<a
						href="https://pablomotta.github.io/sena-chatbot/es"
						class="btn btn-warning btn-md m-2"
						onclick="refreshLocalStorage();"
						>Spanish</a
					>
				</div>
			</div>
			<!-- new -->
			<hr class="mt-5" />
			<div class="text-center mt-5">
				<h2 class="mb-5">Current Location</h2>
				<div id="location"></div>
			</div>
			<!-- new -->
		</div>
	</body>
</html>
